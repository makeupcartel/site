define([
    "jquery",
    "swiper"
], function ($, Swiper) {
    $(document).ready(function () {

        $(location).attr('href');

        var a = window.location.href;
        jQuery('.menu.horizontal li a').each(function() {
            if($(this).attr('href') == a){
                jQuery(this).closest('li').addClass('active has-active');
            }
        });
      
        //checkout button edit shipping field
        $(document).on('click', '.edit-field-btn', function() {
            var id = $(this).data('id');
            if($('#'+id).hasClass('locked')){
                $('#'+id).removeClass('locked');
                $('label.locked[for="'+id+'"]').removeClass('locked');
                $('#'+id).focus();
            }else{
                $('#'+id).focus();
            }
        });

        var checkLogin = $("#checkLogin").val();
        if (checkLogin == 1) {
            $("body.page-product-bundle.catalog-product-view span.price").css("display", "block;");
            $("body.page-product-bundle.catalog-product-view main#maincontent .product-info-price").css("cssText", "display: block !important;");
            $("body.page-product-bundle.catalog-product-view .control span.price-notice").css("cssText", "display: block;");
        }

        $('.block.block-search .control span.close-search').click(function () {
            $('.block.block-content form#search_mini_form .control').css('display', 'none');
        });

        $('.block.block-title').click(function () {
            $('.block.block-content form#search_mini_form .control').css('display', 'block');
        });

        $('.amsearch-closes').click(function () {
            $('div#search_autocomplete').css('display', 'none');
            $('input#search').val('');
            $('.amsearch-closes').css('display', 'none');
        });

        jQuery('.btn-qty.btn-qty-minus').click(function (event) {
            var qty = parseInt(jQuery(this).closest('.control').find(".qty").val()) - 1;
            if (qty <= 0) {

            } else jQuery(this).closest('.control').find('.qty').val(qty);

        });
        // jQuery('.btn-qty.btn-qty-plus').click(function (event) {
        //     var qty = parseInt(jQuery(this).closest('.control').find(".qty").val()) + 1;
        //     jQuery(this).closest('.control').find('.qty').val(qty);
        // });

        //validate stress adress myacount
        $('.street-adress').keyup(function () {
            var stressval = $.trim(this.value);
            if (stressval.length > 40) {
                $('.message-validate-stress-adress').html("Please enter less or equal than 40 characters");
                $('.message-validate-stress-adress').css({'display': 'block'});
                $("button.action.save.primary").attr("disabled", true);
                $('.street-adress').css({'border': 'solid 1px red'});
            } else {
                $('.message-validate-stress-adress').css({'display': 'none'});
                $("button.action.save.primary").attr("disabled", false);
                $('.street-adress').css({'border': 'solid 1px #e4e4e4'});
            }
        });

        $('.tel-account').keyup(function () {
            var x = $.trim(this.value);
            if (x.length < 7) {
                $('.message-validate-phone').html("Please enter more or equal than 7 characters");
                $('.message-validate-phone').css({'display': 'block'});
                $("button.action.save.primary").attr("disabled", true);
                $('.tel-account').css({'border-color': 'red'});
            }else 
            if (validateTelephoneAcocount(x) === 0) {
                $('.message-validate-phone').html("Please enter a valid number in this field.");
                $('.message-validate-phone').css({'display': 'block'});
                $("button.action.save.primary").attr("disabled", true);
                $('.tel-account').css({'border-color': 'red'});
            }else {
                $('.message-validate-phone').css({'display': 'none'});
                $("button.action.save.primary").attr("disabled", false);
                $('.tel-account').css({'border-color': '#e4e4e4'});
            }
        });

        function validateTelephoneAcocount(telephone) 
        {
            var filter = /^[0-9]*$/g;
            if (filter.test(telephone)) 
            {
                return 1;
            } else {
                return 0;
            }
        }

        /*$(".page-product-bundle.catalog-product-view #bundle-slide").trigger('click');*/
        if ($('.checkout-cart-index .cart.table-wrapper .cart.item .item-info').length) {
            var el = $('.checkout-cart-index .cart.table-wrapper .cart.item .item-info');
            el.each(function () {
                var height = $(this).height();
                $(this).find('.product-item-photo').css({"height": height - 50});
            })
        }
        //curren offer page
        $('.offer-wraper .widget.block.block-static-block').each(function () {
            if (!$(this).children().length) {
                $(this).hide();
            }
        });


        $(document).click(function (e) {
            var t = $(e.target),
                l = t.closest('#algolia-searchbox span.algolia-searchbox--icon-search'),
                c = t.closest('#algolia-searchbox span.algolia-searchbox--close');
            if (l.length) {
                l.parent().addClass('over');
            }
            if (c.length) {
                c.parent().removeClass('over');
            }
        });
        setInterval(function () {
            if ($('.checkout-index-index .minicart-items .product-item-details .product-brand').length > 0) {
                $('.checkout-index-index .minicart-items .product-item-details .product-brand').each(function () {
                    $(this).closest('.product-item-inner').find('.subtotal').addClass('reative-subtotal')
                })
            }
        }, 2000);
        //Close other tab win click a button on header
        jQuery('.customer-name').click(function () {
            jQuery('.page-wrapper .page-header .header.content .header-right .ui-dialog').hide();
        });
        jQuery('.page-wrapper .page-header .header.content .header-right .minicart-wrapper .action.showcart').click(function () {
            jQuery('.customer-welcome').removeClass('active');
        });
        jQuery('.actions.dropdown.options.switcher-options .switcher-trigger').click(function () {
            jQuery('.page-wrapper .page-header .header.content .header-right .ui-dialog').hide();
            jQuery('.customer-welcome').removeClass('active');
        });

        if (jQuery('.page-wrapper .page-header .header.content .header-right > .header.links2 > li.authorization-link a').length) {
            jQuery('.page-wrapper .page-header .header.content .header-right > .header.links2 > li.authorization-link a').text('Sign In');
        }

        /* OVERRIDE TOGGLE FUNCTION ON PRODUCT PAGE */
        $('.product.data.items>.item.title').click(function (e) {
            e.preventDefault();
            $(this).toggleClass('opening');
            $(this).next().toggleClass('opening');
        });


        /* STICKY ADD TO CART BUTTON ON MOBILE PRODUCT PAGE */
        if ($('.product-info-main .product-add-form form #product-addtocart-button').length) {
            var text = $('.product-mobile-title-wrapper .sticky-buttons .sticky-atc-button').data('text');
            var price = $('.product-info-main .product-info-price [data-price-type="finalPrice"] .price').text();
            if (price) {
                $('.product-mobile-title-wrapper .sticky-buttons .sticky-atc-button').text(text + ' - ' + price);
            }
        }
        $('.sticky-buttons .sticky-atc-button').click(function (e) {
            e.preventDefault();
            $('.product-info-main .product-add-form form #product-addtocart-button').trigger('click');
        });

        /* READ MORE BTN ON PRODUCT PAGE SHORT DESCRIPTION */
        /* $('.readmore-short-desc').click(function (e) {
             var descfull = $('.product.data.items>.item.title:first-child');
             e.preventDefault();
             $(this).closest('.sub-short-desc').hide();
             $(this).closest('.sub-short-desc').parent().find('.full-short-desc').show();
             $(descfull).toggleClass('opening');
             $(descfull).next().toggleClass('opening');
             $('html, body').animate({
                 scrollTop: $('.product.data.items>.item.title:first-child').offset().top - 20
             }, 'slow');


         });

         $('.readless-full-desc').click(function (e) {
             e.preventDefault();
             $(this).closest('.full-short-desc').slideUp();
             $(this).closest('.full-short-desc').parent().find('.sub-short-desc').show();
         });*/


        $('.readmore-short-desc').click(function (e) {
            e.preventDefault();
            $('.sub-short-desc').hide();
            $('.full-short-desc').show();

        });

        $('.readless-full-desc').click(function (e) {
            e.preventDefault();
            $('.sub-short-desc').show();
            $('.full-short-desc').hide();

        });

        /* SEARCH MOBILE */
        $('.block.block-title').click(function (e) {
            e.preventDefault();
            $('.block.block-content').show();
            $('.block-search .label').trigger("click");
        });
        $('.algolia-searchbox--close').click(function (e) {
            e.preventDefault();
            $('.block.block-content').hide();
        })

        $('.block-search .label.active').click(function (e) {
            e.preventDefault();
            $('.block.block-content').hide();
        })

        /* COMMON FUNCTION ALIGN HEIGHT */
        var width = jQuery(window).width();

        function alignHeight(selector) {
            jQuery(selector).css('height', '');
            var minHeight = 0;
            jQuery(selector).each(function () {
                if (minHeight < jQuery(this).outerHeight()) {
                    minHeight = jQuery(this).outerHeight();
                }
            });
            if (minHeight > 0) {
                jQuery(selector).css('height', minHeight);
            }
        }

        /*ALIGN HEIGHT PRODUCT GRID HOMEPAGE*/
        setTimeout(function () {
            alignHeight('.account.wishlist-index-index .products-grid.wishlist .product-item .product-item-info .product-item-name .product-item-link');
            alignHeight('.account.wishlist-index-index .products-grid.wishlist .product-item .product-item-info .price-box');
            alignHeight('.cms-index-index .columns .column.main .block-products-list.grid .products-grid.grid a.product-item-photo');
        }, 500);
        jQuery(window).resize(function () {
            setTimeout(function () {
                alignHeight('.account.wishlist-index-index .products-grid.wishlist .product-item .product-item-info .product-item-name .product-item-link');
                alignHeight('.account.wishlist-index-index .products-grid.wishlist .product-item .product-item-info .price-box');
            }, 500);
        });

        /*ADD QTY MY FAVOURITE*/
        jQuery('.minus_wishlist').click(function (event) {
            var qty = parseInt(jQuery(this).closest('.control').find(".qty-wish").val()) - 1;
            if (qty <= 0) {

            } else jQuery(this).closest('.control').find('.qty-wish').val(qty);

        });
        jQuery('.plus_wishlist').click(function (event) {
            var qty = parseInt(jQuery(this).closest('.control').find(".qty-wish").val()) + 1;
            jQuery(this).closest('.control').find('.qty-wish').val(qty);
        });
        var width = jQuery(window).width();
        if (width < 768) {
            /*click sidebar my account mobile*/
            if (jQuery('.sidebar-main .block-collapsible-nav').length) {
                var text = jQuery('.sidebar-main .block-collapsible-nav .block-collapsible-nav-content .nav.item.current strong').text();
                jQuery('.sidebar-main .block-collapsible-nav .block-collapsible-nav-title strong').text(text);
            }
            jQuery('.account .page-title-wrapper').insertBefore(jQuery('.account .sidebar-main'));
        }

        //faq function click
        $('.content-faq .QandA .answer').hide();
        $('.content-faq .QandA:first-of-type .answer').show();
        $('.content-faq .QandA:first-of-type h4').addClass('active');
        $('.content-faq .QandA h4').click(function () {
            $(this).next().slideToggle();
            $(this).toggleClass('active');
            $(this).parent().siblings().find('.answer').slideUp();
            $(this).parent().siblings().find('.question').removeClass('active');
        })

        //sidebar cms page
        if ($('body').find('.sidebar-cms').length > 0) {
            var title = globalTitle.toLowerCase();
            $('#' + title).addClass('current');
            var titleShowMobile = '<div class="current-page">' + titlePageCms + '</div>';
            $('.sidebar-cms').prepend(titleShowMobile);
            $('.current-page').click(function () {
                $(this).toggleClass('active');
                $(this).closest('.sidebar-cms').find('.content').slideToggle();
            });
        }


    });
})